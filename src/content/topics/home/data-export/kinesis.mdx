---
path: '/home/data-export/kinesis'
title: 'Kinesis'
description: 'This topic explains how to create and test a Kinesis destination for Data Export.'
published: true
---

## Overview

This topic explains how to create and test a Kinesis destination for Data Export.

You can export all of the flag evaluation and event data generated by LaunchDarkly SDKs to a Kinesis data stream.

## Prerequisites

To set up a Kinesis destination, you must configure your AWS account with the following information:

- A Kinesis stream you want to export the data to. You can use an existing stream if you already have one.
- An IAM policy that can put records into your Kinesis stream
- An IAM role that LaunchDarkly can assume that provides access to the policy

If you don't already have a Kinesis stream, create one by reading [Amazon's documentation](https://docs.aws.amazon.com/streams/latest/dev/amazon-kinesis-streams.html).

<Callout intent="info">
<CalloutTitle>Recommended shard count</CalloutTitle>
<CalloutDescription>

As a best practice, we recommend that you use **1 shard for every 50 million events you send us a month**. This recommendation is an estimate based on typical usage patterns, not a requirement.

To prevent performance degradation, adjust your shard count based on your actual usage at peak times. If you expect to see usage spikes, provision more shards. If you do not use enough shards for the load, AWS may throttle your data stream. If this happens, you may experience data loss.

</CalloutDescription>
</Callout>

## Creating the IAM Policy

This section explains how to create an IAM policy to support the Kinesis Data Export.

<Callout intent="info">
<CalloutTitle>Save this information</CalloutTitle>
<CalloutDescription>

If you create a new Kinesis stream, write down or save the following information:

* Region
* Stream name
* Stream ARN

You will need this information when you configure your export.

</CalloutDescription>
</Callout>

To create an IAM policy:

1. Sign in to the [Identity and Access Management (IAM) console](https://console.aws.amazon.com/iam/).
2. Follow [Amazon's documentation](http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html) to create an IAM policy that allows LaunchDarkly to write to your Kinesis Stream.
3. Select the **Create Policy from JSON** option.
4. Use the following template policy to configure the Policy Document field:


<CodeTabs
  defaultValue="json"
  values={[
    { label: 'Example', value: 'json', },
  ]
}>
<CodeTabItem value="json">

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
          "kinesis:PutRecord",
          "kinesis:PutRecords"
      ],
      "Resource": [
          "arn:aws:kinesis:{region}:{account-id}:stream/{stream-name}"
      ]
    }
  ]
}
```

</CodeTabItem>
</CodeTabs>

5. If you have a _stream ARN_ already configured, you can paste the entire ARN in. At least, change the following fields to include the values you specified during IAM policy configuration:

- `{region}`
- `{account-id}`
- `{stream-name}`.

6. Click **Save**.
7. After you create the policy, write down or save the policy's name.

## Creating an IAM Role

This section explains how to create a cross-account IAM role for LaunchDarkly to assume so it can access the policy.

To create a cross-account IAM role:

1. Log into AWS and [access the IAM section](https://console.aws.amazon.com/iamhome#/roles$new?step=type&roleType=crossAccount).
2. In the Account ID section, enter `554582317989` as shown in the image below. This allows LaunchDarkly to assume the role:

![The Account ID section of the Create a role screen.](kinesis-create-role.png)


3. Add the policy you created earlier to this role. Write down or save the _role ARN_.

<Callout intent="alert">
<CalloutTitle>Restricting trust</CalloutTitle>
<CalloutDescription>

It's safe and straightforward to set up the role as described above, but your organization may have security requirements limiting what kind of roles you can trust.

If your organization's security policies require you to trust a specific role, we've provided a role for you to trust instead. Only Data Export services can assume this role, not accounts belonging to people.

The role is: `arn:aws:iam::554582317989:role/LaunchDarkly-data-export`

Trust our role by following a procedure in [Amazon's documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_manage_modify.html#roles-managingrole-editing-console).

</CalloutDescription>
</Callout>

## Creating the Kinesis Destination in LaunchDarkly

With the _region_, _stream name_ and _role ARN_ from earlier in the procedure, you can now create the Kinesis destination within LaunchDarkly.

To create the Kinesis destination:

1. Navigate to the **[Integrations page](https://app.launchdarkly.com/default/integrations)** and find the Amazon Kinesis card.

![The add destination screen.](kinesis-add.png)

2. Click **+ Integration.** The integration screen appears.
3. (Optional) Enter a Name for the destination.
4. Choose an environment from the **Environment** drop-down list.
5. Enter the AWS data you saved earlier:

- AWS Kinesis stream region
- ROle address
- AWS Kinesis stream name

6. Click **Save**:

![A Kinesis destination with AWS information, a name and environment selected.](kinesis-create.png)


## Testing the Kinesis Destination

After you've saved the destination, send a test event to confirm that the destination is configured properly.

1. From the Integrations page, click the edit button on the Amazon Kinesis card. The Edit destination screen appears.
2. In the Send a test event section, click **Send Event**:

![The Send a test event screen.](kinesis-test-event.png)

2. If you have configured the destination correctly, an event is logged in the Kinesis destination.
3. Identify a successful test event by searching for the user or flag key `LaunchDarklyDataExportTestEvent`. When this key appears in the destination, you know the test event arrived.

<Callout intent="info">
<CalloutTitle>Partition Keys</CalloutTitle>
<CalloutDescription>

Kinesis records have [partition keys](https://docs.aws.amazon.com/streams/latest/dev/key-concepts.html#partition-key). When we create a record, we use the user key that was sent with the event as the partition key. If the event does not contain a user key, we create a random partition key.

</CalloutDescription>
</Callout>

## Consuming the Kinesis Data Stream

Kinesis Data Streams are very flexible. You can consume them in a lambda function, write an application to consume the streams, and use a number of pre-built AWS integrations.

A common use case is to use the Data Stream to populate a data store, such as S3 or Redshift, by setting the Kinesis Data Stream as a source to a Kinesis Data Firehose. To learn how to do this, read [Amazon's documentation](https://docs.aws.amazon.com/firehose/latest/dev/writing-with-kinesis-streams.html).

## Enabling Data Export for flags and environments

After you create a Data Export destination, you must start sending flag or environment event data to it. You can enable Data Export for individual flags, or for all the flags in an environment.

To learn more about exporting event data from flags and environments, read [Exporting event data for flags and environments](/home/data-export#exporting-event-data-for-flags-and-environments).

## Deleting a Kinesis destination

You can delete a Data Export destination from the **Integrations** screen.

To delete a destination:

1. Navigate to the **Integrations** screen.
2. Find the destination you wish to delete and click **Edit**. The "Edit destination" screen opens.
3. Click **Delete Destination**:

![The Delete destination section.](destination-delete.png)
